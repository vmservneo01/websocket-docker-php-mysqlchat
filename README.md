## Real-time WebSocket Chat Application built with Docker-Compose
### Краткая информация
Приложение написано на PHP(исходник приложения: [Real-time WebSocket Chat](https://github.com/AhmedYahyaE/realtime-websocket-php-chat-application)),которое собирается автоматически с помощью Docker-compose
### Основные заметки
Приложение работает на двух веб-серверах apache и nginx.Apache забирает на себя всю осносвную нагрузку,nginx забирает статические файлы([vendor-front](/nginx/www/vendor-front)) и перенаправляет все соединения websocket на веб-сервер apache([websockchat.conf](/nginx/websockchat.conf)).
Также присутствует БД Mysql в которую попадает вся история диалогов в чатах. Еще присутствует ELK-стек который отображает логи nginx.Внутри контейнера с apache устанавливается supervisor для поднятия php-server, на котором работает websocket.
Запустить приложение можно с помощью файла [chat.sh](chat.sh) указав в /etc/hosts(на клиенте с которого будем подключаться) ip и доменное имя(вариант для yandexcloud),для локальной сети указать доменное имя и внутренний ip машины(127.0.0.1).
### Краткое описание/Изменения(на всякий случай)
1. [vhosts](apache/vhosts) - все основные конфиги для apache(самое важное [websockchat.ru.conf](apache/vhosts/websockchat.ru))
2. [www](apache/www) - здесь находится само приложение.Напоминание: чтобы чат работал правильно нужно указать свое доменное имя(на котором работают сервера) в файлах [private_chat.php](apache/www/private_chat.php) и [group_chat.php](apache/www/group_chat.php) (здесь:var conn = new WebSocket('ws://(свой домен)/ws/)
3. [dump_db](apache/dump_db) - внутри папки находится файл, который автоматически дампится в контейнер mysql, для того чтобы создать таблицу для записей из чатов(chat_application)
4. [dump_db](apache/dump_db) - отмечу еще один важный момент,eсли добавлять volume вместе с docker-entrypoint база данных не будет создана,потому что при дампе баз данных подключается этот volume и затирает все инфу,которую пытается дампить docker-entrypoint, поэтому используем отдельно друг от друга 
5. [.env](.env) - здесь находится пароль от БД и сама база.Используется в [docker-compose.yml](docker-compose.yml) в создании контейнера mysql(environment)
6. [websockchat.conf](nginx/websockchat.conf) - в этом конфиге настраиваются соединения для корректной работы приложения.В качестве уточнения отмечаю,что в этом файле встречается блок location /vendor-front в котором указывается путь к статическому контенту(он находится уже внутри контейнера(как и сам файл websockchat.conf)) и который также нужно указать в docker-compose.yml(в nginx) путь к статическом контенту [vendor-front](nginx/www/vendor-front)
7. [scripts](nginx/scripts) - здесь находятся скрипты, два из которых настраивают автоматически сертификаты websockchat.ru и elk.digitalagro.ru, и еще один для создания учетной записи и входу в elk по паролю(внутри также находится команда nginx -g daemon off).Также из-за того что теперь наш nginx работает только по протоколу https:// то и websocket должен работать по wss:// соответственно
